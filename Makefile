# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:    #
#                                                     +:+ +:+         +:+      #
#    By: xlamiel- <xlamiel-@student.42barcelona.com>+#+  +:+       +#+         #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/08/01 22:51:59 by xlamiel-          #+#    #+#              #
#    Updated: 2025/11/04 15:40:17 by xlamiel-         ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

###############################################################################
# ü™Ñ‚ñ∂Ô∏è Command line
###############################################################################
#
# gcc ./src/pipex.c \
#	-I./include \
#	-I./libft/include \
#	-L./libft \
#	-lft \
#	-opipex
#
###############################################################################
# üì¶ Project Configuration
###############################################################################

NAME		:= pipex
SRC_DIR		:= src
OBJ_DIR		:= obj
DEP_DIR		:= dep
INCLUDE_DIR	:= include
LIBFT_DIR	:= ./libft
LIBFT		:= $(LIBFT_DIR)/libft.a

###############################################################################
# üõ†Ô∏è Tools & Commands
###############################################################################

CC			:= cc
RM			:= rm -f
MKDIR		:= mkdir -p

###############################################################################
# ‚öôÔ∏è Compilation Flags
###############################################################################

CFLAGS		:= -Wall -Wextra -Werror
DEPFLAGS	:= -MMD -MP
INCLUDES	:= -I$(INCLUDE_DIR) -I$(LIBFT_DIR)/include
LDFLAGS		:= -L$(LIBFT_DIR)
LDLIBS		:= -lft

###############################################################################
# üé® Terminal Colors
###############################################################################

GREEN		:= \033[0;32m
RED			:= \033[0;31m
RESET		:= \033[0m

###############################################################################
# üìÑ Source Files
###############################################################################

SRC			:= \
	$(SRC_DIR)/pipex.c \
	$(SRC_DIR)/ppx_error.c \
	$(SRC_DIR)/ppx_exec.c \
	$(SRC_DIR)/ppx_io.c \
	$(SRC_DIR)/ppx_memory.c \
	$(SRC_DIR)/ppx_path.c \
	$(SRC_DIR)/ppx_process.c \
	$(SRC_DIR)/ppx_split_utils.c \
	$(SRC_DIR)/ppx_split_helpers.c

###############################################################################
# üîß Derived File Lists
###############################################################################

OBJ			:= $(patsubst $(SRC_DIR)/%.c,$(OBJ_DIR)/%.o,$(SRC))
DEPS		:= $(patsubst $(SRC_DIR)/%.c,$(DEP_DIR)/%.d,$(SRC))

###############################################################################
# üöÄ Build Targets
###############################################################################

all: | $(OBJ_DIR) $(DEP_DIR)
all: $(LIBFT) $(NAME)

$(NAME): $(OBJ)
	@$(CC) $(CFLAGS) $(OBJ) $(LDFLAGS) $(LDLIBS) -o $@
	@echo "$(GREEN)‚úÖ Executable '$@' created$(RESET)"

$(LIBFT):
	@$(MAKE) -C $(LIBFT_DIR)

###############################################################################
# üß± Object Compilation
###############################################################################

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c Makefile | $(OBJ_DIR) $(DEP_DIR)
	@$(CC) $(CFLAGS) $(DEPFLAGS) $(INCLUDES) -c $< -o $@ -MF $(DEP_DIR)/$(notdir $*.d)

###############################################################################
# üìÅ Directory Creation
###############################################################################

$(OBJ_DIR):
	@$(MKDIR) $@

$(DEP_DIR):
	@$(MKDIR) $@

###############################################################################
# üßπ Cleaning Rules
###############################################################################

clean:
	@$(RM) -rf $(OBJ_DIR) $(DEP_DIR)
	@echo "$(RED)üßπ Object and dependency files removed$(RESET)"
	@$(MAKE) -C $(LIBFT_DIR) clean

fclean: clean
	@$(RM) $(NAME)
	@echo "$(RED)üßπ Executable '$(NAME)' removed$(RESET)"
	@$(MAKE) -C $(LIBFT_DIR) fclean

re: fclean all

###############################################################################
# üêû Debug Build
###############################################################################

debug:
	#@$(MAKE) -C $(LIBFT_DIR) debug
	@$(MAKE) CFLAGS="$(CFLAGS) -g3" DEPFLAGS="$(DEPFLAGS)" re

###############################################################################
# üìé Dependency Inclusion
###############################################################################

#-include $(wildcard $(DEPS))
-include $(DEPS)

###############################################################################
# üìå Phony Targets
###############################################################################

.PHONY: all clean fclean re debug
